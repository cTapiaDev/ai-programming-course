


Perfecto, voy a generar la clase ResilientClient siguiendo todas las reglas y constraints especificados. Esta clase implementarÃ¡ el patrÃ³n Circuit Breaker con una mÃ¡quina de estados manual para reemplazar el cÃ³digo legacy.

Created
resilient-client.ts
+222
-0
Â¡Perfecto! He generado la clase 
ResilientClient
 en el archivo [
resilient-client.ts
](file:///f:/Cursos/Curso%20IA/1%20clase/ai-programming-course/modulo-1-fundamentos/taller/src/resilient-client.ts).

âœ… CaracterÃ­sticas Implementadas
1. Stack Moderno (MitigaciÃ³n de Vulnerabilidades 1, 2, 3, 6)
âœ… TypeScript estricto con interfaces claras (
CircuitState
, 
ApiResponse
, 
ClientConfig
)
âœ… fetch nativo de Node.js (sin require('https') ni librerÃ­as externas)
âœ… Timeout de 2000ms con AbortController y signal
âœ… Tipado completo de todos los parÃ¡metros y retornos
2. Circuit Breaker - MÃ¡quina de Estados (MitigaciÃ³n de Vulnerabilidad 8)
âœ… Estados: CLOSED, OPEN, HALF-OPEN
âœ… Propiedades: failureCount, lastFailureTime, resetTimeoutMs: 5000
âœ… Transiciones automÃ¡ticas:
CLOSED â†’ OPEN: Cuando failureCount >= 3 (umbral)
OPEN â†’ HALF-OPEN: DespuÃ©s de 5000ms desde el Ãºltimo fallo
HALF-OPEN â†’ CLOSED: PeticiÃ³n de prueba exitosa
HALF-OPEN â†’ OPEN: PeticiÃ³n de prueba fallida
3. Manejo Robusto de Errores (MitigaciÃ³n de Vulnerabilidades 4, 5, 7)
âœ… ValidaciÃ³n HTTP: Verifica response.ok (status 200-299)
âœ… Parsing JSON seguro: Con try-catch para manejar JSON malformado
âœ… PropagaciÃ³n de errores: Lanza excepciones apropiadas (nunca devuelve null)
âœ… ValidaciÃ³n de entrada: Valida el parÃ¡metro userId
âœ… Manejo de timeout: Detecta y reporta timeouts especÃ­ficamente
4. Cumplimiento de Restricciones
âœ… Sin librerÃ­as externas: Solo APIs nativas de Node.js
âœ… LÃ³gica encapsulada: La transiciÃ³n CLOSED â†’ OPEN estÃ¡ en el mÃ©todo 
onFailure()
, no hay if (failureCount >= 3) explÃ­cito en el flujo principal
5. CaracterÃ­sticas Adicionales
ğŸ” MÃ©todo 
getState()
: Para debugging y monitoring del estado actual
ğŸ”„ MÃ©todo 
reset()
: Para resetear manualmente el circuito (Ãºtil en testing)
âš™ï¸ ConfiguraciÃ³n flexible: Constructor acepta configuraciÃ³n personalizada
ğŸ“¦ Instancia por defecto exportada: resilientClient lista para usar
ğŸ¯ Ejemplo de Uso
typescript
import { ResilientClient } from './resilient-client';

const client = new ResilientClient({
  baseUrl: 'https://api-externa.com',
  requestTimeoutMs: 2000,
  resetTimeoutMs: 5000
});

try {
  const userData = await client.getUserData('123');
  console.log('User data:', userData);
} catch (error) {
  console.error('Error:', error.message);
}

// Verificar estado del circuito
console.log('Circuit state:', client.getState());
El cÃ³digo estÃ¡ listo para reemplazar completamente el 
legacy-client.ts
 y cumple con todas las reglas especificadas en tu documento de constraints! ğŸš€